<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/static/style.css">
    <title>Skin Homes</title>
</head>
<body>
    <div class="container">
        <form id="upload-form" enctype="multipart/form-data">
            <h1 class="main_title">SKIN HOMES</h1>
            <div id="file-container">
                <label id="file-label" for="file-input">
                    <input type="file" id="file-input" accept="image/*" onchange="previewImage()">
                </label>
            </div>
            <div id="image-preview">
                <!-- 선택된 이미지가 여기에 표시됩니다. -->
            </div>
            <div id="button-container">
                <button type="button" class="check_button" onclick="uploadImage()">
                    <img src="/static/search.png" alt="Button Image">
                </button>
            </div>
        </form>
        <div id="result-container" style="display: none;">
            <div id="predicted-image">
                <!-- 예측된 이미지가 여기에 표시됩니다. -->
            </div>
            <div id="result">
                <!-- 예측 결과가 여기에 표시됩니다. -->
            </div>
            <div id="explanation-box">
                <!-- 설명란 -->
            </div>
        </div>
        <div class="buttonbox">
            <div id="refresh-button" style="display: none;">
                <a onClick="window.location.reload()" class="refresh-button">
                    <img src="/static/return.png" sizes="24px"/>
                </a>
            
            </div>
            <div id="plus-button" style="display: none;">
                <a onClick="window.location.reload()" class="plus-button">
                    <img src="/static/youtube.png" size="24px"/>
                </a> 
            </div>
        </div>
        <script>
            function previewImage() {
                var fileInput = document.getElementById('file-input');
                var fileContainer = document.getElementById('file-container');
                var imagePreview = document.getElementById('image-preview');
                imagePreview.innerHTML = '';

                if (fileInput.files && fileInput.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        var image = document.createElement('img');
                        image.src = e.target.result;
                        image.alt = 'Selected Image';
                        image.style.maxWidth = '300px';
                        imagePreview.appendChild(image);
                        fileContainer.style.display = 'none';
                        imagePreview.style.display = 'block';
                    };

                    reader.readAsDataURL(fileInput.files[0]);
                }
            }

            function uploadImage() {
                var fileInput = document.getElementById('file-input');
                var imagePreview = document.getElementById('image-preview');
                var buttonContainer = document.getElementById('button-container');
                var resultContainer = document.getElementById('result-container');
                var refreshButton = document.getElementById('refresh-button');
                var plusButton = document.getElementById('plus-button');

                imagePreview.style.display = 'none';
                buttonContainer.style.display = 'none';
                refreshButton.style.display = 'none';
                plusButton.style.display = 'none';

                var file = fileInput.files[0];

                var formData = new FormData();
                formData.append('file', file);

                fetch('http://localhost:5000/upload', {
                    method: 'POST',
                    body: formData
                })
                // fetch('https://web-graduation-work-5mk12alp9undmc.sel5.cloudtype.app/upload', {
                //     method: 'POST',
                //     body: formData
                // })
                .then(response => response.json())
                .then(data => {
                    console.log(data.result);

                    var predictedImageDiv = document.getElementById('predicted-image');
                    predictedImageDiv.innerHTML = '';
                    var predictedImage = document.createElement('img');
                    predictedImage.src = 'data:image/png;base64,' + data.result[0].image;
                    predictedImage.alt = 'Predicted Image';
                    predictedImage.style.maxWidth = '300px';
                    predictedImageDiv.appendChild(predictedImage);

                    var resultDiv = document.getElementById('result');
                    resultDiv.innerHTML = '';
                    
                    var explanDiv = document.getElementById('explanation-box');
                    explanDiv.innerHTML = '';
                    if (Array.isArray(data.result)) {
                        data.result.forEach(obj => {
                            var p = document.createElement('p');
                            p.innerHTML = ` - ${obj.class}: ${obj.confidence*100}%`;
                            resultDiv.appendChild(p);
                        });
                    } else {
                        var p = document.createElement('p');
                        p.innerHTML = data.result;
                        resultDiv.appendChild(p);
                    }
                    switch(data.result[0].class){
                        case '여드름' : 
                            var p = document.createElement('p');
                            p.innerHTML = `털 피지선 샘 단위의 만성 염증질환으로 면포, 구진, 고름물집, 결절, 거짓낭 등 
                            다양한 피부 변화가 나타나며, 이에 따른 후유증으로 오목한 흉터 또는 확대된 흉터를 남기기도 한다. 피지선이 모여 있는 얼굴, 목, 가슴 등에 많이 발생하며 털을 만드는 모낭에 붙어있는 피지선에 염증이 생기는 질환을 말한다.`;
                            explanDiv.appendChild(p);
                            break;
                        case '모공각화증' : 
                            var p = document.createElement('p');
                            p.innerHTML = `모공 각화증은 팔, 다리 등의 바깥쪽 부분에 모공을 따라 작은 돌기가 나타나면서 외관상 닭살 모양의 피부를 보이는 질환이다. 
                            유전성 질환이며,모낭에 박힌 각질 마개에 의해 때때로 모공 주위가 붉거나 갈색으로 보여 미관상 문제를 일으키는 경우가 있다.`;
                            explanDiv.appendChild(p);
                            break;
                        case '습진' : 
                            var p = document.createElement('p');
                            p.innerHTML = `습진은 공통적인 임상적, 조직학적 특징을 보이는 피부 질환군을 통칭하는 용어이다. 피부 증상을 살펴보면 초기에는 주로 가려움과 함께 물집 구진, 홍반, 부기 등이 관찰되며 만성기에는 부기, 
                            물집은 줄어드는 대신 피부 주름이 두드러지거나 피부가 두꺼워지는 태선화, 비늘, 색소침착 등을 보인다.`
                            explanDiv.appendChild(p);
                            break;
                        case '일반 피부' : 
                            var p = document.createElement('p');
                            p.innerHTML = `정상적인 피부로 문제가 보이지 않습니다!`;
                            explanDiv.appendChild(p);
                            break;
                        case '대상포진' : 
                            var p = document.createElement('p');
                            p.innerHTML = `대상포진은 수두-대상포진 바이러스가 몸 속에 잠복상태로 존재하고 있다가 다시 활성화되면서 발생하는 질병이다.
                            보통은 수일 사이에 피부에 발진과 특징적인 물집 형태의 병변이 나타나고 해당 부위에 통증이 동반된다.`;
                            explanDiv.appendChild(p);
                            break;
                        case '건선' : 
                            var p = document.createElement('p');
                            p.innerHTML = `건선은 은백색의 비늘로 덮여 있고, 경계가 뚜렷하며 크기가 다양한 붉은색의 구진이나 판으로 주로 구성된 발진이 전신의 피부에 반복적으로 발생하는 만성 염증성 피부질환으로, 
                                조직 검사상 표피의 증식과 진피의 염증을 특징으로 하며, 인구의 1~2%의 빈도로 나타납니다.`;
                            explanDiv.appendChild(p);
                            break;
                        case '백선증' : 
                            var p = document.createElement('p');
                            p.innerHTML = `백선균이 표피·모·손톱과 발톱에 기생하여 얕은 병변을 나타내는 것을 천재성 백선, 모포로부터 침입하여 진피 내에 깊은 병변을 일으키는 것을 심재성 백선이라고 한다. 
                                임상 증세는 백선균이 기생하는 부위에 따라 다르다.`;
                            explanDiv.appendChild(p);
                            break;
                        case '사마귀' : 
                            var p = document.createElement('p');
                            p.innerHTML = `사마귀는 피부 또는 점막이 사람 유두종 바이러스에 감염되어 발생하는 질환으로, 표피의 과다한 증식이 일어나 임상적으로는 표면이 오돌토돌한 구진으로 나타납니다.
                                어느 부위의 피부에나 발생할 수 있으나 노출 부위인 손, 발, 다리, 얼굴 등에 주로 발생하고, 성 접촉을 통해 성기에도 발생할 수 있습니다`;
                            explanDiv.appendChild(p);
                            break;
                        default :
                            var p = document.createElement('p');
                            p.innerHTML = '없는 데이터 질병 입니다. 가까운 병원에 방문하여 의사와 상의하세요!';
                            explanDiv.appendChild(p);                       
                    }    

                    resultContainer.style.display = 'block';
                    refreshButton.style.display = 'block';
                    plusButton.style.display = 'block';
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }

            function refreshPage() {
                location.reload();
            }
        </script>
    </div>
</body>
</html>
